\section{Boundary Conditions}
\label{sec:bcs}
Threeg kinds of Boundary Conditions (BCs) are applied in this research: Analytic Absorbing Boundary Conditions (ABC),
Perfectly Matched Layer Absorbing Boundary Conditions (PML) and Periodic Boundary Conditions (PBC). All three kinds of
BCs have the purpose to create a fake infinite space with finite computation domain. The difference is ABC and PML are
design for making only one set of structure appear in computation domain rather than place infinite sets of identical
structure like PBC.


\subsection{Analytic Absorbing Boundary Conditions}
To hold the outgoing field from being reflected at boundary, the ABC is operative in one dimension FDTD lattice. Once we
assume there are no sources outside the computation region, the wave must be porpagaing outward directly and the value
of field at two ends can be estimate with the relation through Courant Condition.
\begin{equation}
  E|_0^n = E|_1^{n-2}
\end{equation}
\begin{equation}
  E|_k^n = E|_{k-1}^{n-2}
\end{equation}



\subsection{Perfectly Matched Layer Absorbing Boundary Conditions}
\label{subsec:pml}
For 2-D and 3-D simulation, the ABC discussed above is no longer useful due to the reason the ABC can only absorb
normally incident wave. The Berenger's PML (BPML) [\textit{Berenger} 1994], also known as Split-Field PML, was firstly
proposed. Before long, Unaxial PML (UPML) [\textit{Sacks et al}, 1995] are proposed with similar performance in
mathematics but different machenism. Convolution PML (CPML) was also proposed later...

By inserting coefficients of UPML into Eq.\ref{eq:up_d} and Eq.\ref{eq:up_b}, half of update equations become
following. Owing to the $\bar{\bar{s}}$ parameter can be reduced to $1$ in non-PML region, the new update equations are
apt to be applied on whole computation domain.
\begin{gather}
  j\omega\bar{\bar{s}}\ \widetilde{D}(\omega) = c_0\curlH(\omega)\\
  j\omega\bar{\bar{s}}\ \widetilde{B}(\omega) = -c_0\curlE(\omega)
\end{gather}
where $\bar{\bar{s}}$ should satisfy
\begin{equation}
  \bar{\bar{s}} = 
  \begin{bmatrix}
    \displaystyle\frac{s_ys_z}{s_x}& 0& 0\\
    0& \displaystyle\frac{s_xs_z}{s_y}& 0\\
    0& 0& \displaystyle\frac{s_xs_y}{s_z}
  \end{bmatrix}
\end{equation}
and 
\begin{equation}
  s_x = 1 + \frac{\sigma_x}{j\omega\epsilon_0},\ 
  s_y = 1 + \frac{\sigma_y}{j\omega\epsilon_0},\ 
  s_z = 1 + \frac{\sigma_z}{j\omega\epsilon_0}
\end{equation}
Several profiles have been suggested for grading $\sigma_d(n)$, The most successfully used one is expressed as
\begin{equation}
  \sigma_d(n) = (n/d)^2\sigma_{d,max}
\end{equation}
where $n$ is the distance apart from the edge of computation domain.

expand to three dimension
\begin{equation}
  j\omega s_y s_z \widetilde{D}_x = c_0 s_x \curlHxThree
\end{equation}
\begin{equation}
  j\omega s_x s_z \widetilde{D}_y = c_0 s_y \curlHyThree
\end{equation}
\begin{equation}
  j\omega s_x s_y \widetilde{D}_z = c_0 s_z \curlHzThree
\end{equation}
\begin{equation}
  j\omega s_y s_z \widetilde{B}_x =-c_0 s_x \curlExThree
\end{equation}
\begin{equation}
  j\omega s_x s_z \widetilde{B}_y =-c_0 s_y \curlEyThree
\end{equation}
\begin{equation}
  j\omega s_x s_y \widetilde{B}_z =-c_0 s_z \curlEzThree
\end{equation}
Expanding for solving
\begin{equation}
  j\omega
  \left( 1 + \frac{\sigma_y}{j\omega \epsilon_0} \right)
  \left( 1 + \frac{\sigma_z}{j\omega \epsilon_0} \right)\widetilde{D}_x 
  = c_0 \left( 1+\frac{\sigma_x}{j\omega \epsilon_0} \right) \curlHxThree
\end{equation}
Perform inverse Fourier transform and approximate 
\begin{equation}
  \frac{\partial}{\partial t}\widetilde{D}_x + \left( \frac{\sigma_y}{\epsilon_0} + \frac{\sigma_z}{\epsilon_0} \right) \widetilde{D}_x
  = c_0 \left( 1+\int_0^T\frac{\sigma_x}{\epsilon_0} \right) \curlHxThree
\end{equation}
Discrete
\begin{equation}
  \begin{split}
    \frac{\widetilde{D}_x|^{n+\frac{1}{2}} - \widetilde{D}_x|^{n+\frac{1}{2}}}{\Delta t} &+
    \left( \frac{\sigma_y}{\epsilon_0} + \frac{\sigma_z}{\epsilon_0} \right) \frac{\widetilde{D}_x|^{n+\frac{1}{2}} + \widetilde{D}_x|^{n+\frac{1}{2}}}{2} \\
    &=\frac{c_0}{\Delta x} \left( 1 + \sum_0^T \frac{\sigma_x}{\epsilon_0} \right) curl\_hx
  \end{split}
\end{equation}
rearrange and approximate again
\begin{equation}
  \begin{split}
    \widetilde{D}_x|^{n+\frac{1}{2}} &=
    \frac{\displaystyle 1 - \frac{\sigma_y\Delta t}{2\epsilon_0}}{\displaystyle 1 + \frac{\sigma_y\Delta t}{2\epsilon_0}} \cdot \frac{\displaystyle 1 - \frac{\sigma_z\Delta t}{2\epsilon_0}}{\displaystyle 1 + \frac{\sigma_z\Delta t}{2\epsilon_0}} \cdot \widetilde{D}_x|^{n-\frac{1}{2}}\\
    & + \frac{1}{\displaystyle 1 + \frac{\sigma_y\Delta t}{2\epsilon_0}} \cdot \frac{1}{\displaystyle 1 + \frac{\sigma_z\Delta t}{2\epsilon_0}} \cdot 0.5 \left( curl\_hx + \frac{\sigma_x \Delta t}{\epsilon_0}\sum_0^T curl\_hx \right)
  \end{split}
\end{equation}
It would be helpful to define some variables here
\begin{equation}
  v3 = \frac{\displaystyle 1 - \frac{\sigma_d\Delta t}{2\epsilon_0}}{\displaystyle 1 + \frac{\sigma_d\Delta t}{2\epsilon_0}}
\end{equation}
\begin{equation}
  v2 = \frac{1}{\displaystyle 1 + \frac{\sigma_d\Delta t}{2\epsilon_0}}
\end{equation}
\begin{equation}
  v1 = \frac{\sigma_d \Delta t}{\epsilon_0} 
\end{equation}
where $v = i,j,k$ and $d = x,y,z$, and the solution of $\widetilde{D}_x$ can be rewritten as 
\begin{equation}
  \widetilde{D}_x|^{n+\frac{1}{2}} = j3 \cdot k3 \cdot \widetilde{D}_x|^{n-\frac{1}{2}} + j2 \cdot k2 \cdot 0.5 \cdot \left( curl\_hx + i1 \cdot \sum_0^T curl\_hx \right)
\end{equation}
The rest 5 update equations in UPML can be derived with similar procedure to be following.
\begin{equation}
  \widetilde{D}_y|^{n+\frac{1}{2}} = i3 \cdot k3 \cdot \widetilde{D}_y|^{n-\frac{1}{2}} + i2 \cdot k2 \cdot 0.5 \cdot \left( curl\_hy + j1 \cdot \sum_0^T curl\_hy \right)
\end{equation}
\begin{equation}
  \widetilde{D}_z|^{n+\frac{1}{2}} = i3 \cdot j3 \cdot \widetilde{D}_z|^{n-\frac{1}{2}} + i2 \cdot j2 \cdot 0.5 \cdot \left( curl\_hz + k1 \cdot \sum_0^T curl\_hz \right)
\end{equation}
\begin{equation}
  \widetilde{B}_x|^{n+1} = j3 \cdot k3 \cdot \widetilde{B}_x|^{n} - j2 \cdot k2 \cdot 0.5 \cdot \left( curl\_ex + i1 \cdot \sum_0^T curl\_ex \right)
\end{equation}
\begin{equation}
  \widetilde{B}_y|^{n+1} = i3 \cdot k3 \cdot \widetilde{B}_y|^{n} - i2 \cdot k2 \cdot 0.5 \cdot \left( curl\_ey + j1 \cdot \sum_0^T curl\_ey \right)
\end{equation}
\begin{equation}
  \widetilde{B}_z|^{n+1} = i3 \cdot j3 \cdot \widetilde{B}_z|^{n} - i2 \cdot j2 \cdot 0.5 \cdot \left( curl\_ez + k1 \cdot \sum_0^T curl\_ez \right)
\end{equation}





\subsubsection{Reduce to Two Dimension}
reduce to two dimension $\partial / \partial z \rightarrow 0$ and $s_z \rightarrow 1$
\begin{equation}
  j\omega s_y \widetilde{D}_x = c_0 s_x \curlHxTwo
\end{equation}
\begin{equation}
  j\omega s_x \widetilde{D}_y = c_0 s_y \curlHyTwo
\end{equation}
\begin{equation}
  j\omega s_x s_y \widetilde{D}_z = c_0 \curlHzTwo
\end{equation}
\begin{equation}
  j\omega s_y \widetilde{B}_x = c_0 s_x \curlExTwo
\end{equation}
\begin{equation}
  j\omega s_x \widetilde{B}_y = c_0 s_y \curlEyTwo
\end{equation}
\begin{equation}
  j\omega s_x s_y \widetilde{B}_z = c_0 \curlEzTwo
\end{equation}
Follow coequal steps shown in three dimension, update equations can be written as 
\begin{equation}
  \widetilde{D}_x|^{n+\frac{1}{2}} = j3 \cdot \widetilde{D}_x|^{n-\frac{1}{2}} + j2 \cdot 0.5 \cdot \left( curl\_hx + i1 \cdot \sum_0^T curl\_hx \right)
\end{equation}
\begin{equation}
  \widetilde{D}_y|^{n+\frac{1}{2}} = i3 \cdot \widetilde{D}_y|^{n-\frac{1}{2}} + i2 \cdot 0.5 \cdot \left( curl\_hy + j1 \cdot \sum_0^T curl\_hy \right)
\end{equation}
\begin{equation}
  \widetilde{D}_z|^{n+\frac{1}{2}} = i3 \cdot j3 \cdot \widetilde{D}_z|^{n-\frac{1}{2}} + i2 \cdot j2 \cdot 0.5 \cdot \left( curl\_hz + \sum_0^T curl\_hz \right)
\end{equation}
\begin{equation}
  \widetilde{B}_x|^{n+1} = j3 \cdot \widetilde{B}_x|^{n} - j2 \cdot 0.5 \cdot \left( curl\_ex + i1 \cdot \sum_0^T curl\_ex \right)
\end{equation}
\begin{equation}
  \widetilde{B}_y|^{n+1} = i3 \cdot \widetilde{B}_y|^{n} - i2 \cdot 0.5 \cdot \left( curl\_ey + j1 \cdot \sum_0^T curl\_ey \right)
\end{equation}
\begin{equation}
  \widetilde{B}_z|^{n+1} = i3 \cdot j3 \cdot \widetilde{B}_z|^{n} - i2 \cdot j2 \cdot 0.5 \cdot \left( curl\_ez + \sum_0^T curl\_ez \right)
\end{equation}




\subsection{Periodic Boundary Conditions}
Comparing with PML, PBC is 
